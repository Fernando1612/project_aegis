# Project AEGIS: Hybrid Algorithmic Trading System (v2.1)

**Project AEGIS** is a low-resource, high-autonomy trading system designed for the Raspberry Pi 4. It implements a "Pilot vs. Strategist" architecture where a deterministic trading bot (The Pilot) is guided by an LLM-powered risk manager (The Strategist).

## 1. Architecture Overview

The system consists of three Docker containers running on an internal network, utilizing the **Kukapay Freqtrade MCP** as the bridge.

```mermaid
graph TD
    subgraph Hardware [Raspberry Pi 4 8GB RAM]
        subgraph Docker_Network [Internal Network: trading_net]
            Pilot[Freqtrade - The Pilot] -- "Executes Trades" --> Exchange((Exchange))
            Pilot -- "API" --> Bridge
            Bridge[MCP Wrapper (Kukapay Freqtrade MCP)] -- "Exposes Tools" --> Strategist
            Strategist[AEGIS Brain (The Strategist)] -- "MCP Client" --> Bridge
            Strategist -- "Context" --> Gemini((Google Gemini))
            Strategist -- "Store/Recall" --> Memory[(SQLite BankMemory)]
        end
    end
```

### Components
1.  **The Pilot (Freqtrade):** Runs the `BBRSI_Optimized` strategy. It handles the minute-by-minute execution of trades.
2.  **The Bridge (MCP Wrapper):** A containerized version of [kukapay/freqtrade-mcp](https://github.com/kukapay/freqtrade-mcp). It exposes Freqtrade's API as Model Context Protocol (MCP) tools.
3.  **The Strategist (AEGIS Brain):** A Python application acting as an **MCP Client**. It periodically fetches market context via the Bridge, consults Google Gemini for a risk assessment, and stores decisions in a local SQLite database.

### New Feature: Closed-Loop Memory Reinforcement
The Strategist now possesses a "BankMemory" that allows it to learn from past decisions:
-   **Market Snapshots:** Before every decision, the context and the AI's reasoning are saved.
-   **Reconciliation:** The system periodically checks for closed trades and links them back to the original prediction.
-   **RAG (Retrieval-Augmented Generation):** When making a new decision, the Brain retrieves similar past scenarios (e.g., "RSI_HIGH" conditions) and sees whether its past advice led to a Profit or Loss.

## 2. Hardware Setup (Raspberry Pi 4)

### Prerequisites
- Raspberry Pi 4 (4GB or 8GB recommended)
- SSD connected via USB 3.0 (MicroSD cards are not recommended for DB operations)
- Raspberry Pi OS (64-bit)

### Optimization Steps
1.  **Enable ZRAM:** To optimize memory usage on the Pi.
    ```bash
    sudo apt install zram-tools
    echo "PERCENT=50" | sudo tee -a /etc/default/zramswap
    sudo service zramswap reload
    ```
2.  **Install Docker & Docker Compose:**
    ```bash
    curl -fsSL https://get.docker.com -o get-docker.sh
    sudo sh get-docker.sh
    sudo usermod -aG docker $USER
    sudo apt install -y docker-compose-plugin
    ```

## 3. Deployment

1.  **Clone the Repository:**
    ```bash
    git clone <repo_url> project_aegis
    cd project_aegis
    ```

2.  **Configuration:**
    Copy the example environment file and edit it with your keys.
    ```bash
    cp .env.example .env
    nano .env
    ```
    *   Set `GEMINI_API_KEY`
    *   Set Exchange credentials
    *   Set `FT_USER` and `FT_PASSWORD` (Must match Freqtrade config)

3.  **Launch:**
    ```bash
    docker compose up -d
    ```
    *Note: The `mcp_wrapper` container will clone and build the Kukapay repository on first launch.*

4.  **Verify:**
    Check the logs to ensure all services are running correctly.
    ```bash
    docker compose logs -f
    ```

## 4. Project Structure

```
project_aegis/
├── aegis_brain/          # The Strategist (MCP Client + LLM Logic)
│   ├── brain.py          # Main logic loop (Reconciliation + RAG)
│   ├── memory_manager.py # SQLite Database Manager
│   ├── Dockerfile        # Container definition
│   └── requirements.txt  # Python dependencies
├── freqtrade/            # The Pilot (Trading Bot)
│   └── user_data/
│       └── strategies/
│           └── BBRSI_Optimized.py # Custom Strategy
├── mcp_wrapper/          # The Bridge (Kukapay Integration)
│   └── Dockerfile        # Clones and builds kukapay/freqtrade-mcp
├── scripts/              # Maintenance scripts
├── docker-compose.yml    # Orchestration
├── .env.example          # Config template
└── .gitignore            # Git configuration
```

## 5. Security Notes
- **Network:** All containers communicate via an internal bridge network (`trading_net`). Only ports 8080 (Freqtrade UI) and 8000 (MCP Server) are exposed to the host.
- **Logs:** Docker logging is limited to 10MB per container to prevent SSD wear.
- **Secrets:** Never commit `.env` or `user_data/config.json` to version control.

---
*Generated by Antigravity for Project AEGIS*
